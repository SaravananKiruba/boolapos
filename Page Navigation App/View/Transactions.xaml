<UserControl x:Class="Page_Navigation_App.View.Transactions"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="800">

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Transaction Entry Form -->
        <mah:MetroHeader Header="Transaction Details">
            <mah:MetroContentControl>
                <StackPanel>
                    <ComboBox ItemsSource="{Binding TransactionTypes}"
                              SelectedItem="{Binding SelectedTransaction.TransactionType}"
                              Margin="0,5"
                              mah:TextBoxHelper.Watermark="Transaction Type"
                              Style="{StaticResource MahApps.Styles.ComboBox}"/>

                    <mah:NumericUpDown Value="{Binding SelectedTransaction.Amount}"
                                      Margin="0,5"
                                      mah:TextBoxHelper.Watermark="Amount"
                                      Style="{StaticResource {x:Type mah:NumericUpDown}}"
                                      StringFormat="C"
                                      Minimum="0"/>

                    <mah:DateTimePicker SelectedDateTime="{Binding SelectedTransaction.TransactionDate}"
                                       Margin="0,5"
                                       mah:TextBoxHelper.Watermark="Transaction Date"
                                       Style="{StaticResource {x:Type mah:DateTimePicker}}"/>

                    <TextBox Text="{Binding SelectedTransaction.Description}"
                             Margin="0,5"
                             mah:TextBoxHelper.Watermark="Description"
                             Style="{StaticResource MahApps.Styles.TextBox}"
                             TextWrapping="Wrap"
                             AcceptsReturn="True"
                             Height="80"/>

                    <StackPanel Orientation="Horizontal" 
                              Margin="0,20,0,0"
                              HorizontalAlignment="Right">
                        <Button Content="Clear"
                                Margin="0,0,10,0"
                                Style="{StaticResource MahApps.Styles.Button}"
                                Command="{Binding ClearCommand}"/>
                        
                        <Button Content="Save"
                                Style="{StaticResource MahApps.Styles.Button.Square.Accent}"
                                Command="{Binding AddOrUpdateCommand}"/>
                    </StackPanel>
                </StackPanel>
            </mah:MetroContentControl>
        </mah:MetroHeader>

        <!-- Transaction List -->
        <mah:MetroHeader Grid.Column="1"
                        Margin="20,0,0,0"
                        Header="Transaction History">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Filter Controls -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <ComboBox ItemsSource="{Binding TransactionTypes}"
                              SelectedItem="{Binding FilterTransactionType}"
                              Width="150"
                              Margin="0,0,10,0"
                              mah:TextBoxHelper.Watermark="Filter by Type"
                              Style="{StaticResource MahApps.Styles.ComboBox}"/>

                    <TextBox Grid.Column="1"
                             Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}"
                             mah:TextBoxHelper.Watermark="Search transactions..."
                             Style="{StaticResource MahApps.Styles.TextBox}">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Return" Command="{Binding SearchCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <Button Grid.Column="2"
                            Margin="10,0"
                            Style="{StaticResource MahApps.Styles.Button.Square}"
                            Command="{Binding SearchCommand}">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Kind="Magnify" 
                                                           Margin="0,0,5,0"/>
                            <TextBlock Text="Search"/>
                        </StackPanel>
                    </Button>

                    <Button Grid.Column="3"
                            Style="{StaticResource MahApps.Styles.Button.Square}"
                            Command="{Binding ExportCommand}">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Kind="FileExport" 
                                                           Margin="0,0,5,0"/>
                            <TextBlock Text="Export"/>
                        </StackPanel>
                    </Button>
                </Grid>

                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding Transactions}"
                          SelectedItem="{Binding SelectedTransaction}"
                          AutoGenerateColumns="False"
                          Style="{StaticResource MahApps.Styles.DataGrid}"
                          GridLinesVisibility="Horizontal"
                          SelectionMode="Single"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Date" 
                                          Binding="{Binding TransactionDate, StringFormat=d}"
                                          Width="120"/>
                        <DataGridTextColumn Header="Type" 
                                          Binding="{Binding TransactionType}"
                                          Width="120"/>
                        <DataGridTextColumn Header="Amount" 
                                          Binding="{Binding Amount, StringFormat=C}"
                                          Width="120"/>
                        <DataGridTextColumn Header="Description" 
                                          Binding="{Binding Description}"
                                          Width="*"/>
                        <DataGridTemplateColumn Width="Auto">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Style="{StaticResource MahApps.Styles.Button.Circle}"
                                                Width="32"
                                                Height="32"
                                                Margin="0,0,5,0"
                                                ToolTip="Edit"
                                                Command="{Binding DataContext.EditCommand, 
                                                        RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}">
                                            <iconPacks:PackIconMaterial Kind="Pencil" Width="16" Height="16"/>
                                        </Button>
                                        <Button Style="{StaticResource MahApps.Styles.Button.Circle}"
                                                Width="32"
                                                Height="32"
                                                ToolTip="Delete"
                                                Command="{Binding DataContext.DeleteCommand, 
                                                        RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                CommandParameter="{Binding}">
                                            <iconPacks:PackIconMaterial Kind="Delete" Width="16" Height="16"/>
                                        </Button>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </mah:MetroHeader>
    </Grid>
</UserControl>
