<UserControl x:Class="Page_Navigation_App.View.Categories"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="800">

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Category Entry Form -->
        <mah:MetroHeader Header="Category Details">
            <mah:MetroContentControl>
                <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="550">
                    <StackPanel>
                        <TextBox Text="{Binding SelectedCategory.CategoryName, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,5"
                                 mah:TextBoxHelper.Watermark="Category Name"
                                 Style="{StaticResource MahApps.Styles.TextBox}"/>

                        <TextBox Text="{Binding SelectedCategory.Description, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,5"
                                 mah:TextBoxHelper.Watermark="Description"
                                 Style="{StaticResource MahApps.Styles.TextBox}"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 Height="60"/>
                                 
                        <TextBlock Text="Making Charges and Wastage" 
                                  FontWeight="Bold" 
                                  Margin="0,10,0,5"/>
                        
                        <mah:NumericUpDown Value="{Binding SelectedCategory.DefaultMakingCharges}"
                                          Margin="0,5"
                                          mah:TextBoxHelper.Watermark="Default Making Charges (%)"
                                          Style="{StaticResource {x:Type mah:NumericUpDown}}"
                                          Minimum="0"
                                          Maximum="100"
                                          StringFormat="F2"/>
                                          
                        <mah:NumericUpDown Value="{Binding SelectedCategory.DefaultWastage}"
                                          Margin="0,5"
                                          mah:TextBoxHelper.Watermark="Default Wastage (%)"
                                          Style="{StaticResource {x:Type mah:NumericUpDown}}"
                                          Minimum="0"
                                          Maximum="100"
                                          StringFormat="F2"/>
                                          
                        <mah:ToggleSwitch Header="Active Status"
                                          IsOn="{Binding SelectedCategory.IsActive}"
                                          Margin="0,10,0,5"
                                          OnContent="Active"
                                          OffContent="Inactive"/>

                        <StackPanel Orientation="Horizontal" 
                                  Margin="0,20,0,0"
                                  HorizontalAlignment="Right">
                            <Button Content="Clear"
                                    Margin="0,0,10,0"
                                    Style="{StaticResource MahApps.Styles.Button}"
                                    Command="{Binding ClearCategoryCommand}"/>
                            <Button Content="Save"
                                    Style="{StaticResource MahApps.Styles.Button.Accent}"
                                    Command="{Binding AddCategoryCommand}"
                                    Margin="0,0,10,0"/>
                            <Button Content="Update"
                                    Style="{StaticResource MahApps.Styles.Button.Accent}"
                                    Command="{Binding UpdateCategoryCommand}"/>
                        </StackPanel>
                        
                        <!-- Subcategory Section -->
                        <TextBlock Text="Subcategory Details" 
                                  FontWeight="Bold" 
                                  Margin="0,30,0,5"/>
                                  
                        <TextBox Text="{Binding SelectedSubcategory.SubcategoryName, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,5"
                                 mah:TextBoxHelper.Watermark="Subcategory Name"
                                 Style="{StaticResource MahApps.Styles.TextBox}"/>
                                 
                        <TextBox Text="{Binding SelectedSubcategory.Description, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,5"
                                 mah:TextBoxHelper.Watermark="Description"
                                 Style="{StaticResource MahApps.Styles.TextBox}"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 Height="60"/>
                                 
                        <mah:NumericUpDown Value="{Binding SelectedSubcategory.SpecialMakingCharges}"
                                          Margin="0,5"
                                          mah:TextBoxHelper.Watermark="Special Making Charges (%)"
                                          Style="{StaticResource {x:Type mah:NumericUpDown}}"
                                          Minimum="0"
                                          Maximum="100"
                                          StringFormat="F2"/>
                                          
                        <mah:NumericUpDown Value="{Binding SelectedSubcategory.SpecialWastage}"
                                          Margin="0,5"
                                          mah:TextBoxHelper.Watermark="Special Wastage (%)"
                                          Style="{StaticResource {x:Type mah:NumericUpDown}}"
                                          Minimum="0"
                                          Maximum="100"
                                          StringFormat="F2"/>
                                          
                        <mah:ToggleSwitch Header="Active Status"
                                          IsOn="{Binding SelectedSubcategory.IsActive}"
                                          Margin="0,10,0,5"
                                          OnContent="Active"
                                          OffContent="Inactive"/>
                                          
                        <StackPanel Orientation="Horizontal" 
                                  Margin="0,20,0,0"
                                  HorizontalAlignment="Right">
                            <Button Content="Clear"
                                    Margin="0,0,10,0"
                                    Style="{StaticResource MahApps.Styles.Button}"
                                    Command="{Binding ClearSubcategoryCommand}"/>
                            <Button Content="Add Subcategory"
                                    Style="{StaticResource MahApps.Styles.Button.Accent}"
                                    Command="{Binding AddSubcategoryCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </mah:MetroContentControl>
        </mah:MetroHeader>

        <!-- Categories and Subcategories Tabs -->
        <mah:MetroHeader Grid.Column="1"
                        Header="Categories and Subcategories">
            <TabControl Style="{StaticResource MahApps.Styles.TabControl}">
                <!-- Categories Tab -->
                <TabItem Header="Categories">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <DataGrid Grid.Row="1"
                                  ItemsSource="{Binding Categories}"
                                  SelectedItem="{Binding SelectedCategory, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  Style="{StaticResource MahApps.Styles.DataGrid}"
                                  GridLinesVisibility="Horizontal"
                                  SelectionMode="Single"
                                  IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" 
                                                  Binding="{Binding CategoryName}"
                                                  Width="*"/>
                                <DataGridTextColumn Header="Making Charges" 
                                                  Binding="{Binding DefaultMakingCharges, StringFormat='{}{0:N2}%'}"
                                                  Width="120"/>
                                <DataGridTextColumn Header="Wastage" 
                                                  Binding="{Binding DefaultWastage, StringFormat='{}{0:N2}%'}"
                                                  Width="120"/>
                                <DataGridTextColumn Header="Status" 
                                                  Binding="{Binding IsActive, Converter={StaticResource BooleanToActiveConverter}}"
                                                  Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>
                
                <!-- Subcategories Tab -->
                <TabItem Header="Subcategories">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" 
                                  Text="{Binding SelectedCategory.CategoryName, StringFormat='Subcategories for: {0}'}"
                                  FontWeight="Bold"
                                  Margin="0,0,0,10"/>

                        <DataGrid Grid.Row="1"
                                  ItemsSource="{Binding Subcategories}"
                                  SelectedItem="{Binding SelectedSubcategory, Mode=TwoWay}"
                                  AutoGenerateColumns="False"
                                  Style="{StaticResource MahApps.Styles.DataGrid}"
                                  GridLinesVisibility="Horizontal"
                                  SelectionMode="Single"
                                  IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" 
                                                  Binding="{Binding SubcategoryName}"
                                                  Width="*"/>
                                <DataGridTextColumn Header="Making Charges" 
                                                  Binding="{Binding SpecialMakingCharges, StringFormat='{}{0:N2}%'}"
                                                  Width="120"/>
                                <DataGridTextColumn Header="Wastage" 
                                                  Binding="{Binding SpecialWastage, StringFormat='{}{0:N2}%'}"
                                                  Width="120"/>
                                <DataGridTextColumn Header="Status" 
                                                  Binding="{Binding IsActive, Converter={StaticResource BooleanToActiveConverter}}"
                                                  Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>
            </TabControl>
        </mah:MetroHeader>
    </Grid>
</UserControl>